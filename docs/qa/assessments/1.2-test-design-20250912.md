# Test Design: Story 1.2

Date: 2025-09-12
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 12
- Unit tests: 5 (41.7%)
- Integration tests: 4 (33.3%)
- E2E tests: 3 (25.0%)
- Priority distribution: P0: 4, P1: 5, P2: 3

## Test Scenarios by Acceptance Criteria

### AC1: 内置策略模板：提供至少一个可运行的策略模板（含示例参数），支持一键加载/重置到编辑器。

#### Scenarios

| ID             | Level       | Priority | Test                                              | Justification                                      |
| -------------- | ----------- | -------- | ------------------------------------------------- | -------------------------------------------------- |
| 1.2-UNIT-001   | Unit        | P1       | 模板加载函数返回含 source/params 的有效对象        | 纯逻辑与结构校验，适合单元测试                     |
| 1.2-INT-001    | Integration | P1       | `StrategyEditor` 点击“Load Template”后渲染模板内容 | 组件与模板资源交互，验证渲染与状态更新             |
| 1.2-UNIT-002   | Unit        | P2       | “Reset to Template” 逻辑重置到默认初值              | 纯状态还原逻辑                                     |

Mitigates risks: [BUS-002]

---

### AC2: 语法高亮与基础编辑体验（行号、自动缩进、错误高亮占位）。

#### Scenarios

| ID             | Level       | Priority | Test                                              | Justification                                      |
| -------------- | ----------- | -------- | ------------------------------------------------- | -------------------------------------------------- |
| 1.2-UNIT-003   | Unit        | P2       | 高亮/配置对象生成与语言设定为 python               | 配置对象为纯数据                                   |
| 1.2-INT-002    | Integration | P1       | 编辑器渲染包含行号、占位错误高亮                   | 组件渲染与属性交互                                 |
| 1.2-PERF-001   | Integration | P1       | 懒加载/动态导入不阻塞首屏（性能预算对比）          | 性能相关交互需集成级验证（对 PERF-001 风险）        |

Mitigates risks: [PERF-001]

---

### AC3: 依赖声明 requirements 维护与校验，提交时一并保存/传递。

#### Scenarios

| ID             | Level       | Priority | Test                                                         | Justification                               |
| -------------- | ----------- | -------- | ------------------------------------------------------------ | ------------------------------------------- |
| 1.2-UNIT-004   | Unit        | P0       | 包名/版本校验（不允许 *、非法字符；版本运算符白名单）         | 安全/数据完整性关键逻辑，需快速反馈           |
| 1.2-INT-003    | Integration | P0       | 非法依赖被 UI 阻止，显示错误并禁用提交                        | 表单与验证器的交互行为                       |

Mitigates risks: [SEC-001, DATA-002]

---

### AC4: 元数据可编辑并在提交时随作业上送。

#### Scenarios

| ID             | Level       | Priority | Test                                                | Justification                           |
| -------------- | ----------- | -------- | --------------------------------------------------- | --------------------------------------- |
| 1.2-UNIT-005   | Unit        | P1       | 元数据 Schema（name/tags/description/timestamp）校验 | 纯数据校验逻辑                           |
| 1.2-INT-004    | Integration | P1       | `submitBacktest` payload 包含 metadata 与 requirements | 服务层 payload 组装与契约验证             |

Mitigates risks: [BUS-001, DATA-001]

---

### AC5: 可测与可集成（前端单元/集成覆盖），预留 E2E 钩子（登录后进入编辑器页）。

#### Scenarios

| ID             | Level | Priority | Test                                                | Justification                                |
| -------------- | ----- | -------- | --------------------------------------------------- | -------------------------------------------- |
| 1.2-E2E-001    | E2E   | P0       | 未登录访问 `(dashboard)/backtests` 跳转到 `/login`  | 用户关键路径与安全相关，应在 E2E 层验证        |
| 1.2-E2E-002    | E2E   | P1       | 登录后访问 `(dashboard)/backtests` 可见编辑器与按钮 | 关键用户旅程可见性                           |
| 1.2-SEC-001    | Unit  | P0       | 所有用户输入渲染前 escapeHTML                       | 安全基线，快速反馈（对应 XSS 风险 SEC-002）   |

Mitigates risks: [OPS-001, SEC-002]

## Risk Coverage

- SEC-001（供应链风险）→ 1.2-UNIT-004, 1.2-INT-003
- OPS-001（受保护路由）→ 1.2-E2E-001
- PERF-001（编辑器性能）→ 1.2-PERF-001
- SEC-002（XSS/注入）→ 1.2-SEC-001
- DATA-001（草稿一致性）→ 1.2-INT-004
- DATA-002（参数/依赖合法性）→ 1.2-UNIT-004
- BUS-001（与 1.3 契约）→ 1.2-INT-004
- BUS-002（上手难度）→ 1.2-UNIT-001/002

## Recommended Execution Order

1. P0 Unit tests（1.2-UNIT-004, 1.2-SEC-001）
2. P0 Integration tests（1.2-INT-003）
3. P0 E2E tests（1.2-E2E-001）
4. P1 Tests（1.2-UNIT-001/003/005, 1.2-INT-001/002/004, 1.2-E2E-002, 1.2-PERF-001）
5. P2 Tests（1.2-UNIT-002/003）

## Trace References

Test design matrix: docs/qa/assessments/1.2-test-design-20250912.md
P0 tests identified: 4
