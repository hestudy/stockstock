# Risk Profile: Story 1.5 — Minimal Observability

Date: 2025-09-19
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 6
- Critical Risks: 1
- High Risks: 3
- Risk Score: 40/100

Key message: 当前目标是“最小可观测性”，范围有限但对稳定性影响巨大。最大风险在于覆盖与告警缺失导致的“瞎子飞行（blind spots）”，其次是错误信息泄漏与 PII/敏感数据写日志的风险。建议在不扩大依赖的前提下，优先完善覆盖/告警基线与数据治理。

## Critical Risks Requiring Immediate Attention

### 1. OPS-001: 监控覆盖缺口导致故障不可感知

- Score: 9 (Critical)
- Probability: High (3) — 当前仅落实“最小栈”，且多路径（前端/API/Workers）初次接入，遗漏概率高
- Impact: High (3) — 故障可能长时间不可见，影响可用性与用户信任
- Mitigation:
  - 最小告警基线：API 路由`status/result`的错误率与高时延阈值告警；Workers 异常分类计数异常告警
  - FE 侧 Sentry（可选）添加关键页面错误告警规则
  - 在评审清单中加入“监控点存在性”校验
- Testing Focus:
  - 集成/E2E：触发失败路径并验证指标/错误上报与告警策略生效（通过 mock/拦截）

## Risk Distribution

### By Category

- Security: 1 risks (0 critical)
- Performance: 1 risks (0 critical)
- Data: 1 risks (0 critical)
- Business: 1 risks (0 critical)
- Operational: 2 risks (1 critical)
- Technical: 0 risks (0 critical)

### By Component

- Frontend: 2 risks
- Backend/API: 2 risks
- Workers: 1 risk
- Cross-cutting/Process: 1 risk

## Detailed Risk Register

| Risk ID   | Category   | Title                                                | Probability | Impact | Score | Priority |
|-----------|------------|------------------------------------------------------|-------------|--------|-------|----------|
| OPS-001   | OPS        | 监控覆盖缺口导致故障不可感知                          | High (3)    | High(3)| 9     | Critical |
| SEC-001   | SEC        | 错误映射缺陷导致内部细节/堆栈信息向客户端暴露        | Medium (2)  | High(3)| 6     | High     |
| DATA-001  | DATA       | 日志含 PII/敏感信息（未脱敏/未分级）                  | Medium (2)  | High(3)| 6     | High     |
| OPS-002   | OPS        | 指标/日志未与基础告警绑定（只能“看”，不能“提醒”）    | Medium (2)  | High(3)| 6     | High     |
| PERF-001  | PERF       | 2s 首屏指标采集噪声大，验证不稳定                    | Medium (2)  | Medium(2)| 4   | Medium   |
| BUS-001   | BUS        | 用户可读提示不一致，影响信任与转化                    | Low (1)     | Medium(2)| 2   | Low      |

Risk scoring: Probability × Impact；排序按分数降序。

## Risk-Based Testing Strategy

### Priority 1: Critical/High Risk Tests

- OPS-001：
  - 断言 API `status/result` 在失败路径写入指标与错误对象；模拟阈值触发，验证“高错误率/高时延”报警规则
  - Workers：异常分类日志与计数器拉升后触发报警（可通过本地/CI 注入）
- SEC-001：
  - FE/API：确保 `ApiError` 对客户端仅暴露安全字段；对 4xx/5xx 分支进行快照/结构断言
- DATA-001：
  - 日志脱敏单测与集成测试；对 PII 字段自动化扫描（规则：邮箱/手机号/证件号等）
- OPS-002：
  - 验证告警策略配置存在且可被触发（含最小静态配置校验）

### Priority 2: Medium Risk Tests

- PERF-001：
  - FE Web Vitals 采集与摘要渲染埋点的稳定性测试；使用 mock 环境确保 2s 目标验证稳定
- BUS-001：
  - 用户可读提示对错误码映射一致性测试（多语言/多场景）

## Risk Acceptance Criteria

- Must Fix Before Production
  - 所有 Critical（9）
  - 与数据/安全相关的 High（6）：SEC-001、DATA-001
- Can Deploy with Mitigation
  - Medium（4）：需有补偿性控制（特征开关/灰度、回滚预案）
  - Low（2-3）：需有最小监控与回归用例
- Accepted Risks
  - 记录团队签署的已接受风险与应急预案

## Monitoring Requirements

- API：按路由+状态码的直方图/计数器，错误率与时延 P95/P99 告警
- FE：关键页面错误率与加载失败告警；摘要渲染耗时分布观察
- Workers：异常分类计数与执行时长分布；重试次数异常告警

## Risk Review Triggers

- 架构或错误处理流发生变化
- 新增集成/导出链路
- 发现新的安全/合规要求
- 性能指标出现退化

---

# Gate YAML Snippet (risk_summary)

用于 Gate 文件 `docs/qa/gates/1.5-minimal-observability.yml` 的片段：

```yaml
risk_summary:
  totals:
    critical: 1
    high: 3
    medium: 1
    low: 1
  highest:
    id: OPS-001
    score: 9
    title: "监控覆盖缺口导致故障不可感知"
  recommendations:
    must_fix:
      - "为 API/Workers 建立错误率与高时延的最小告警基线"
      - "统一错误映射，杜绝堆栈/内部字段向客户端泄露"
      - "日志脱敏与敏感信息过滤规则默认开启"
    monitor:
      - "FE 关键页面错误率与摘要渲染耗时分布"
      - "Workers 异常分类计数与重试次数"
```

Hook line for review task:

```
Risk profile: docs/qa/assessments/1.5-risk-20250919.md
```
