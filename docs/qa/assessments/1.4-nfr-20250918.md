# NFR Assessment: 1.4

Date: 2025-09-18
Reviewer: Quinn

Source story: docs/stories/1.4.status-basic-result.md

## Summary

- Security: PASS - 已对 `status/result` 接口实现按用户+路径的速率限制与 `id` 参数校验；鉴权基于 Supabase JWT 与 `ownerId` 过滤
- Performance: PASS - 首屏摘要 2 秒目标有 E2E 覆盖与前端分步加载策略（摘要先行→曲线懒加载）
- Reliability: PASS - 统一错误映射、轮询与就绪判定、空态处理与重试/返回入口均有设计
- Maintainability: CONCERNS - 局部测试仍有缺口（详情页错误/空态与摘要区 A11y 的断言可进一步增强）

Quality score: 90/100 (1×CONCERNS)

## Evidence

- 鉴权/鉴权与 API 契约：`apps/web/src/app/api/_lib/auth.ts`、`apps/web/src/app/api/v1/backtests/[id]/status/route.ts`、`apps/web/src/app/api/v1/backtests/[id]/result/route.ts`
- 前端首屏与懒加载：`apps/web/src/app/(dashboard)/backtests/[id]/page.tsx`、`apps/web/src/components/summary/SummaryCards.tsx`、`apps/web/src/components/charts/EquityCurve.tsx`
- 错误映射与导出：`apps/web/src/utils/errorMapping.ts`、`apps/web/src/utils/export.ts`
- 共享类型：`packages/shared/src/backtest.ts`
- 故事与验收标准：`docs/stories/1.4.status-basic-result.md`

## Critical Issues

1. Maintainability - 详情页错误/空态与 A11y 断言仍可加强
   - 风险：错误映射与可达性回归难以及时发现
   - 建议：在 `(dashboard)/backtests/[id]` 页面用例中补充失败/空态的可视提示断言与摘要区 `role="status" aria-live="polite"` 断言；现有导出失败与图表交互已在单测层覆盖

## Quick Wins

- 增补导出失败/错误空态/A11y 的测试用例（~3-4h）
 - 增补错误空态与摘要区 A11y 的页面级断言（~2h）；保持导出失败与图表交互用例稳定（已覆盖）

## Gate YAML (copy/paste)

```yaml
nfr_validation:
  _assessed: [security, performance, reliability, maintainability]
  security:
    status: PASS
    notes: "已实现按用户+路径的速率限制与 `id` 参数校验；JWT 鉴权与 ownerId 过滤已落地"
  performance:
    status: PASS
    notes: "2 秒首屏摘要目标有 E2E 覆盖；采用摘要先行+图表懒加载策略"
  reliability:
    status: PASS
    notes: "统一错误映射、轮询就绪、空态与重试路径具备"
  maintainability:
    status: CONCERNS
    notes: "详情页错误/空态与摘要区 A11y 的页面级断言可进一步增强；导出失败与图表交互单测已覆盖"
```

NFR assessment: docs/qa/assessments/1.4-nfr-20250918.md

Gate NFR block ready → paste into qa.qaLocation/gates/1.4-status-basic-result.yml under nfr_validation
