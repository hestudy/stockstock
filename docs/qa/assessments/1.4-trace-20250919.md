# Requirements Traceability Matrix

## Story: 1.4 - Status & Basic Result

### Coverage Summary

- Total Requirements: 7
- Fully Covered: 7 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: 状态查询入口（加载时请求 /status，展示状态/进度/重试信息，失败可读错误与返回/重试）

Coverage: FULL

Given-When-Then Mappings:

- Unit/Integration: `apps/web/src/services/backtests.ts`（对应测试：`apps/web/src/__tests__/backtests.result.service.test.ts`）
  - Given: 存在合法 jobId 且服务层封装 getBacktestStatus
  - When: 调用状态接口成功/429/5xx/网络错误
  - Then: 返回结构映射为 BacktestStatusResponse 并触发统一错误策略
- E2E: `apps/web/e2e/backtests-detail.spec.ts::failed status shows error message and actions`
  - Given: 进入 `(dashboard)/backtests/[id]`，接口拦截返回 `failed`
  - When: 页面渲染状态与错误
  - Then: 显示“作业失败”提示与“重试加载/返回列表”入口

#### AC2: 摘要首屏（2 秒内渲染结果概要卡；未就绪占位并轮询）

Coverage: FULL

- Integration: `apps/web/src/app/(dashboard)/backtests/[id]/__tests__/page.test.tsx`
  - Given: 使用虚拟时钟与轮询策略
  - When: 模拟结果可用/不可用
  - Then: 2s 内摘要可见或显示骨架并继续轮询
- E2E: `apps/web/e2e/backtests-detail.spec.ts::summary visible within 2s`
  - Given: 拦截 status/result 均成功
  - When: 访问详情页
  - Then: `data-testid="summary-cards"` 在 2 秒内可见

#### AC3: 净值曲线（懒加载、缩放与 tooltip、数据可导出）

Coverage: FULL

- Unit: `apps/web/src/components/charts/__tests__/EquityCurve.test.tsx`
  - Given: 懒加载组件与基础数据
  - When: 渲染与交互断言（wheel 缩放、拖拽 pan、hover tooltip）
  - Then: 组件挂载、路径段变化（缩放后 `L` 指令减少）、平移后路径内容变化、tooltip 生成且无异常
- E2E: `apps/web/e2e/backtests-detail.spec.ts`
  - `summary still visible within 2s even with large equity data`：大数据量 equity（5000 点）不阻塞 2 秒摘要渲染（验证懒加载/降级策略）
  - `chart renders and basic interactions work (wheel + hover)`：图表可见、滚轮缩放与 hover 交互无异常且组件仍可见

#### AC4: 结果导出（摘要与曲线数据 CSV/JSON 至少一种，失败有可读提示）

Coverage: FULL

- Unit: `apps/web/src/utils/__tests__/export.test.ts`
  - Given: toCSV/toJSON 正常与异常分支
  - When: 执行导出
  - Then: 成功触发下载或抛错并由上层提示
- Integration: `apps/web/src/components/summary/__tests__/SummaryCards.test.tsx`
  - Given: 导出按钮与错误分支模拟
  - When: toCSV 失败
  - Then: 触发可读提示（alert/toast）
- E2E: `apps/web/e2e/backtests-detail.spec.ts::export CSV & JSON succeed and trigger downloads`
  - Given: 详情页加载完成
  - When: 点击“导出CSV/导出JSON”
  - Then: 触发下载并包含 `backtest-{jobId}` 文件名前缀

#### AC5: 错误与空态（失败/提前停止/取消/缺失结果的统一映射与入口）

Coverage: FULL

- Integration: `apps/web/src/app/(dashboard)/backtests/[id]/__tests__/page.test.tsx`
  - Given: 不同错误分支
  - When: 渲染页面
  - Then: 呈现统一文案与操作入口
- E2E: `apps/web/e2e/backtests-detail.spec.ts::failed status shows error message and actions`
  - Given: status=failed, result=404
  - When: 打开详情页
  - Then: 错误提示存在，且有“重试加载/返回列表”按钮

#### AC6: 可达性（A11y：语义标签、aria-live、按钮 aria-label、图表替代文本/空态）

Coverage: FULL

- Unit/Integration: 若干组件测试断言语义属性
- E2E: `apps/web/e2e/backtests-detail.spec.ts::empty result renders placeholders and a11y roles present`
  - Given: 结果为空（metrics/equity 为空）
  - When: 页面渲染
  - Then: 存在 `role="status"` 且 `aria-live="polite"` 的区域；骨架/空态可视

#### AC7: 测试覆盖（单元/集成覆盖核心逻辑；E2E 贯通登录→详情→2s 摘要）

Coverage: FULL

- Evidence:
  - 单测与集成测试：覆盖摘要渲染、导出、错误映射、服务层分支等
  - E2E：`apps/web/e2e/backtests-detail.spec.ts` 覆盖 2 秒首屏、导出、错误/空态与 A11y 钩子

### Critical Gaps

无（None）

### Test Design Recommendations

1. 已增补 EquityCurve 交互与大数据量验证（unit + e2e），建议持续作为回归基线保留。
2. 可持续观察在不同浏览器下的交互稳定性（非阻断）。
3. 在集成层对 429/5xx 对导出链路影响的断言维持现状即可（现有覆盖已满足 AC4 需求）。

### Risk Assessment

- High Risk: 无
- Medium Risk: 无
- Low Risk: 其余 AC 已具备单测+集成+E2E 的稳定闭环
