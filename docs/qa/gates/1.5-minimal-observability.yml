# <!-- Powered by BMAD™ Core -->
schema: 1
story: "1.5"
story_title: "Minimal Observability"
gate: "CONCERNS" # PASS|CONCERNS|FAIL|WAIVED
status_reason: "安全频控与密钥管理证据不足；覆盖率阈值与部分配置切换用例缺失"
reviewer: "Quinn (Test Architect)"
updated: "2025-09-19T16:45:21+08:00"

waiver: { active: false }

top_issues:
  - id: "SEC-001"
    severity: high
    finding: "缺少明确的敏感端点 rate limit 策略与测试证据"
    suggested_action: "补充频控策略表（方法/路由/桶/时间窗/溢出响应）并在测试中覆盖至少 1 个敏感端点"
  - id: "CONF-001"
    severity: medium
    finding: "密钥/端点配置来源与轮换策略未文档化"
    suggested_action: "在 SECURITY.md 中补充 SENTRY_DSN/OTLP 等变量来源与轮换策略；确保 CI Secret 管理到位"
  - id: "TEST-001"
    severity: medium
    finding: "覆盖率阈值未设定；部分配置切换用例缺失（OTEL_* / NEXT_PUBLIC_*）"
    suggested_action: "在 CI 设定最小阈值（行≥80%/分支≥70%）；补 OTEL_* 与前端开关变体用例"

nfr_validation:
  _assessed: [security, performance, reliability, maintainability]
  security:
    status: CONCERNS
    notes: "Rate limit 策略与密钥管理证据不足；错误包装避免信息泄露"
  performance:
    status: PASS
    notes: "E2E 验证 2s 首屏；API timeHttp 记录路由级时延"
  reliability:
    status: PASS
    notes: "统一错误包装与多分支测试；Workers 结构化日志与单测"
  maintainability:
    status: CONCERNS
    notes: "覆盖率阈值未设；需补集成断言与配置切换用例"

# Optional section: evidence summary
# evidence:
#   story_file: docs/stories/1.5.minimal-observability.md
#   nfr_assessment: docs/qa/assessments/1.5-nfr-20250919.md
