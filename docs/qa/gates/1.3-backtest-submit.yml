# <!-- Powered by BMAD™ Core -->
schema: 1
story: "1.3"
story_title: "Backtest Submit"
gate: "CONCERNS"  # PASS|CONCERNS|FAIL|WAIVED
status_reason: "关键端点与基础可观测性已具备，但共享类型与测试覆盖存在缺口；建议在合并前补齐类型并在合并后尽快完善用例。"
reviewer: "Quinn (Test Architect)"
updated: "2025-09-13T12:18:43+08:00"

waiver: { active: false }

top_issues:
  - id: "TEST-001"
    severity: medium
    finding: "缺失共享类型文件 `packages/shared/src/backtest.ts`（或未检出）。故事宣称共享契约，但仓库未找到该文件。"
    suggested_action: "新增并导出 `BacktestSubmitRequest/Response`、`JobStatus` 等类型，确保前后端一致性。"
  - id: "TEST-002"
    severity: medium
    finding: "AC6 的测试覆盖不完整；当前仅见到 `ready.api` 与错误映射单测，E2E 提交流程仍为占位。"
    suggested_action: "补充服务层集成测试覆盖 `submitBacktest` 成功/失败分支，并将 E2E 提交流程从占位升级为最小可执行。"
  - id: "NFR-001"
    severity: low
    finding: "`/api/health` 含内存速率限制，CI/本地需通过 `RATE_LIMIT_DISABLED=1` 管控；文档提示已给出，但易误触发。"
    suggested_action: "在测试环境默认禁用速率限制，并在 QA/README 中突出标注。"
  - id: "A11Y-001"
    severity: low
    finding: "`(dashboard)/backtests` 的可达性属性（aria-disabled/aria-live）在代码中未验证到对应断言。"
    suggested_action: "增加渲染与行为层的 a11y 断言覆盖。"

risk_summary:
  totals: { critical: 0, high: 0, medium: 2, low: 2 }
  recommendations:
    must_fix:
      - "补齐共享类型并在服务层/组件层引用（阻断类型漂移）"
      - "为 `submitBacktest` 增加集成测试：成功/429/超时/5xx"
    monitor:
      - "在 1.4/1.5 故事中持续完善 E2E 串联，并落地可观测性扩展（依赖探测）"
